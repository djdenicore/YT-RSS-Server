// config.js - Основные настройки сервера и RSS для YouTube
import { fileURLToPath } from 'url';
import path from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default {
  // === НАСТРОЙКИ СЕРВЕРА ===
  server: {
    // Хост для прослушивания (0.0.0.0 для прослушивания всех интерфейсов)
    host: '0.0.0.0',
    
    // Порт сервера
    port: 3000,
    
    // Базовый URL для RSS (если оставить пустым, определится автоматически)
    // Пример: 'http://ваш-ip:3000' или 'https://ваш-домен.com'
    // Важно для YouTube: должен быть доступен из интернета!
    // Если оставить пустым (''), URL будет определяться на основе запроса
    // - локально: http://localhost:3000
    // - по домену: https://ваш-домен.com
    // - по IP: http://192.168.1.100:3000
    baseUrl: '',
  },

  // === НАСТРОЙКИ RSS ДЛЯ YOUTUBE ===
  rss: {
    // Название канала в YouTube Music
    title: 'Test',
    
    // Ссылка на ваш сайт или профиль
    link: 'https://exemple.com/',
    
    // Описание канала (отображается в YouTube) - ОБЯЗАТЕЛЬНО ДЛЯ YOUTUBE
    description: 'Exemple Description',
    
    // Язык контента
    language: 'en',
    
    // Копирайт
    copyright: '© Exemple',
    
    // Автор (ваше имя/псевдоним)
    author: 'Name',
    
    // Email для подтверждения владения RSS в YouTube
    // YouTube отправит письмо на эту почту для верификации
    email: 'exemple@gmail.com',
    
    // Явный контент? (yes/no) - YouTube проверяет это
    explicit: 'no',
    
    // Категория для YouTube
    category: 'Music',
    
    // Подкатегория (опционально)
    subcategory: 'Electronic',
    
    // Обложка канала (URL или путь к файлу)
    // ОБЯЗАТЕЛЬНО для YouTube! Рекомендуется квадратное изображение 3000x3000
    // Примечание: будет скачана, обрезана до квадрата и сохранена в .covers_cache
    channelImage: 'https://playlist_image.png/',
    
    // === ОПТИМИЗАЦИЯ ДЛЯ YOUTUBE ===
    youtube: {
      // Генерировать квадратные обложки из ID3 тегов MP3
      // ВКЛЮЧЕНО: обложки извлекаются из MP3, обрезаются до квадрата, сохраняются в .covers_cache
      generateSquareCovers: true,
      
      // Размер обложки для YouTube (рекомендуется 3000)
      coverSize: 3000,
      
      // Режим обработки не квадратных обложек:
      // 'crop' - обрезать до квадрата (по центру) - РЕКОМЕНДУЕТСЯ ДЛЯ YOUTUBE
      // 'background' - добавить белый фон, сохраняя пропорции
      cropMode: 'crop',
      
      // Автоматически извлекать обложки из MP3 файлов
      extractCoversFromMP3: true,
      
      // Использовать обложку трека как thumbnail в YouTube
      useTrackCoverAsThumbnail: true,
    },
  },

  // === НАСТРОЙКИ ФАЙЛОВОЙ СИСТЕМЫ ===
  paths: {
    // Папка с треками (относительно папки server.js)
    // ПРОСТО БРОСАЙТЕ MP3 ФАЙЛЫ В ЭТУ ПАПКУ
    // Поддерживаются: MP3, M4A, FLAC, WAV, OGG
    // ID3 теги будут извлечены автоматически
    tracksDir: path.join(__dirname, 'tracks'),
    
    // Папка для кэша обложек (не удаляйте, используется для кэширования)
    // Сюда сохраняются обрезанные квадратные обложки
    coversCacheDir: path.join(__dirname, '.covers_cache'),
  },

  // === НАСТРОЙКИ ПАРСИНГА ФАЙЛОВ ===
  fileParsing: {
    // Паттерн для автоматического определения артиста и названия из папок
    // Пример: "Artist - Track Name" папка -> артист: "Artist", название: "Track Name"
    folderPattern: '{artist} - {title}',
    
    // Разделитель между артистом и названием в имени папки
    separator: ' - ',
    
    // Искать ID3 теги в аудиофайлах
    // ВКЛЮЧЕНО: извлекает артиста, название, обложку и другую мета-информацию
    readID3Tags: true,
    
    // Приоритет источника названия:
    // 1. ID3 теги (если есть)
    // 2. Имя файла
    // 3. Имя папки
    titlePriority: ['id3', 'filename', 'foldername'],
  },

  // === НАСТРОЙКИ КЭШИРОВАНИЯ ===
  cache: {
    // Кэшировать обложки (ускоряет генерацию RSS)
    enabled: true,
    
    // Время жизни кэша обложек в миллисекундах (24 часа)
    ttl: 24 * 60 * 60 * 1000,
    
    // Максимальный размер кэша в МБ
    maxSizeMB: 500,
    
    // Время жизни кэша RSS в миллисекундах (5 минут)
    // Меньшие значения ускоряют обновление, но увеличивают нагрузку
    rssCacheDuration: 5 * 60 * 1000,
  },

  // === ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ ===
  advanced: {
    // Показывать подробные логи
    // ВКЛЮЧЕНО: отображает информацию о загрузке файлов, обрезке обложек и т.д.
    verboseLogging: true,
    
    // Автоматически создавать недостающие папки
    createMissingDirs: true,
    
    // Проверять доступность файлов перед добавлением в RSS
    validateFiles: true,
    
    // Максимальное количество треков в RSS (YouTube поддерживает до 100)
    // Можно установить больше, но YouTube покажет только первые 100
    maxTracksInRSS: 10000,
    
    // === НАСТРОЙКИ GUID (ВАЖНО ДЛЯ СТАБИЛЬНОСТИ!) ===
    // Метод генерации GUID для выпусков:
    // 'hash' - на основе хэша файла (рекомендуется, постоянный)
    // ИСПОЛЬЗУЙТЕ 'hash' чтобы треки не вылетали из плейлиста YouTube
    guidMethod: 'hash',
    
    // === НАСТРОЙКИ ОБРАБОТКИ ОБЛОЖЕК ===
    // Удалять старые кэшированные обложки при запуске
    cleanupOldCovers: true,
    
    // Максимальный возраст кэшированных обложек (7 дней)
    maxCoverAge: 7 * 24 * 60 * 60 * 1000,
    
    // === НАСТРОЙКИ БЕЗОПАСНОСТИ ===
    // Разрешать доступ к RSS только с определенных IP (оставить пустым для всех)
    // Пример: ['192.168.1.100', '127.0.0.1']
    allowedIPs: [],
    
    // Требовать базовую аутентификацию для RSS (оставить пустым для отключения)
    // Пример: { username: 'admin', password: 'password123' }
    basicAuth: {
      username: '',
      password: '',
    },
  },
};